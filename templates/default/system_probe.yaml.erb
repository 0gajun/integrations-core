<%
## Populate system_probe_config ##
system_probe_config = {
  system_probe_config: {
    enabled: node['datadog']['system_probe']["enabled"],
    sysprobe_socket: node['datadog']['system_probe']['sysprobe_socket'],
    debug_port: node['datadog']['system_probe']['debug_port'],
    bpf_debug: node['datadog']['system_probe']['bpf_debug'],
    enable_conntrack: node['datadog']['system_probe']['enable_conntrack'],
  }
}

# Take into account options defined under ['extra_config']['system_probe_config']
system_probe_config = @extra_config['system_probe_config'].merge(system_probe_config) unless @extra_config['system_probe_config'].nil?
-%>
# Generated by Chef, local modifications will be overwritten

<%= JSON.parse(system_probe_config.to_json).to_yaml %>
